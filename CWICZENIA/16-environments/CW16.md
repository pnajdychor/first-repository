
# Practical Exercise 21 - Working with Environments / Ćwiczenie praktyczne 21 – Praca ze środowiskami

---

## **English Version**

### Exercise Description

In this practical exercise, our goal is to explore how to work with **Environments** in GitHub Actions, as well as their limitations for non-public repositories.

Here are the instructions for the exercise:

1. **Create a file named** `16-environments.yaml` under the `.github/workflows` folder at the root of your repository.

2. **Name the workflow:** `16 – Working with Environments`.

3. **Add the following trigger:**  
   - a. `workflow_dispatch`: this trigger should accept an input named `target-env`, of type `environment`, with a default value of `staging`.

4. **Set the `run-name` option** of the workflow to:  
   `16 – Working with Environments | env – <retrieve target-env input here>`

5. **Add a single job named `echo`:**  
   - a. It should run on `ubuntu-latest`.  
   - b. It should have the `environment` parameter set to the received input value.  
   - c. It should define an environment variable named `my-env-value` assigned to the value of `MY_ENV_VALUE`, which should be retrieved from Environment variables using the `vars` context. If no value exists, it should default to `'default value'`.  
   - d. The job should contain a single step named **Echo vars**, which should print:  
      `"Env variable: <retrieve the value of my-env-value here>"`.

6. **If not already created, create two Environments: `prod` and `staging`.**  
   - a. Create and configure the `prod` Environment:  
     - i. Go to **Settings → Environments → New Environment**.  
     - ii. Name it `prod`.  
     - iii. Mark the option **Required reviewers** and add yourself as a reviewer.  
     - iv. Enable **Wait timer** and set it to **1 minute**.  
     - v. Add an environment variable `MY_ENV_VALUE` with the value `prod value`.  
   - b. Create and configure the `staging` Environment:  
     - i. Go to **Settings → Environments → New Environment**.  
     - ii. Name it `staging`.  
     - iii. No further configuration is needed.

7. **Commit the changes and push the code.**  
   Trigger the workflow manually from the UI and inspect the result of the workflow run.

8. **Modify the workflow:**  
   - a. Remove the `run-name` option.  
   - b. Remove the `target-env` input.  
   - c. Rename the job `echo` to `deploy-staging`.  
   - d. Hardcode the `environment` parameter to `staging`.  
   - e. Change the **Echo vars** step to print `"Deploying to staging"`.  
   - f. Add a new job named `e2e-tests`:  
     - i. It should run on `ubuntu-latest`.  
     - ii. It should execute only after `deploy-staging` completes successfully.  
     - iii. It should contain a single step named **E2E tests**, which prints `"Running E2E"`.  
   g. Add another job named `deploy-prod`:  
      - i. It should run on `ubuntu-latest`.  
      - ii. It should execute only after `e2e-tests` completes.  
      - iii. It should have the `environment` parameter set to `prod`.  
      - iv. It should define an environment variable `my-env-value` using the value of `MY_ENV_VALUE` from `vars`.  
      - v. It should include one step named **Echo vars**, printing `"Deploying to prod"`.

9. **Commit the changes and push the code.**  
   Trigger the workflow manually from the UI and inspect the results.  
   - What happened to the prod deployment job?  
   - How did you approve it?

---

## **Wersja polska**

### Opis ćwiczenia

W tym ćwiczeniu praktycznym naszym celem jest zbadanie, jak pracować ze **środowiskami (Environments)** w GitHub Actions oraz jakie ograniczenia mają w repozytoriach prywatnych.

Instrukcje do ćwiczenia:

1. **Utwórz plik** `16-environments.yaml` w folderze `.github/workflows` w katalogu głównym repozytorium.

2. **Nazwij workflow:** `16 – Working with Environments`.

3. **Dodaj wyzwalacz:**  
   - a. `workflow_dispatch` – powinien przyjmować dane wejściowe `target-env` typu `environment` z domyślną wartością `staging`.

4. **Ustaw parametr `run-name`** workflowa na:  
   `16 – Working with Environments | env – <wartość target-env>`

5. **Dodaj pojedyncze zadanie `echo`:**  
   - a. Powinno działać na `ubuntu-latest`.  
   - b. Powinno mieć parametr `environment` ustawiony na wartość wejściową.  
   - c. Powinno definiować zmienną środowiskową `my-env-value` z wartością `MY_ENV_VALUE`, pobieraną ze zmiennych środowiska (`vars`). Jeśli zmienna nie istnieje, ma przyjąć wartość `'default value'`.  
   - d. Zadanie powinno zawierać krok **Echo vars**, który wypisze:  
      `"Env variable: <wartość my-env-value>"`.

6. **Jeśli nie istnieją, utwórz dwa środowiska: `prod` i `staging`:**  
   - a. **Dla `prod`:**  
     - i. Przejdź do **Settings → Environments → New Environment**.  
     - ii. Nazwij środowisko `prod`.  
     - iii. Zaznacz opcję **Required reviewers** i dodaj siebie jako recenzenta.  
     - iv. Włącz **Wait timer** i ustaw na **1 minutę**.  
     - v. Dodaj zmienną środowiskową `MY_ENV_VALUE` z wartością `prod value`.  
   - b. **Dla `staging`:**  
     - i. Przejdź do **Settings → Environments → New Environment**.  
     - ii. Nazwij środowisko `staging`.  
     - iii. Nie wymaga dodatkowej konfiguracji.

7. **Zatwierdź zmiany i wypchnij kod.**  
   Uruchom workflow ręcznie z interfejsu i sprawdź wynik działania.

8. **Zmodyfikuj workflow:**  
   - a. Usuń opcję `run-name`.  
   - b. Usuń wejście `target-env`.  
   - c. Zmień nazwę zadania `echo` na `deploy-staging`.  
   - d. Ustaw parametr `environment` na `staging`.  
   - e. W kroku **Echo vars** wyświetl `"Deploying to staging"`.  
   - f. Dodaj nowe zadanie `e2e-tests`:  
     - i. Uruchamiane na `ubuntu-latest`.  
     - ii. Wykonywane tylko, jeśli `deploy-staging` zakończy się sukcesem.  
     - iii. Zawiera jeden krok **E2E tests**, który wypisuje `"Running E2E"`.  
   - g. Dodaj kolejne zadanie `deploy-prod`:  
     - i. Uruchamiane na `ubuntu-latest`.  
     - ii. Wykonywane tylko po zakończeniu `e2e-tests`.  
     - iii. Ustaw parametr `environment` na `prod`.  
     - iv. Zdefiniuj zmienną `my-env-value` z wartością `MY_ENV_VALUE` z `vars`.  
     - v. Dodaj krok **Echo vars**, który wyświetla `"Deploying to prod"`.

9. **Zatwierdź i wypchnij kod.**  
   Uruchom workflow ręcznie i sprawdź wyniki.  
   - Co się stało z zadaniem wdrożenia do `prod`?  
   - W jaki sposób je zatwierdziłeś?

---
