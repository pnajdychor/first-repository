# Practical Exercise 31 - Creating and Using Reusable Workflows

## Exercise Description (Opis ćwiczenia)

### English Version

In this practical exercise, our goal is to get familiar with creating and using reusable workflows.

Here are the instructions for the exercise:

1. Create a file named `18-1-reusable-workflows.yaml` under the `.github/workflows` folder at the root of your repository.

2. Name the workflow **18 – 1 – Reusable Workflows – Reusable Definition**.

3. Add the following triggers with event filters and activity types to your workflow:  
   - a. `workflow_call`: additionally, the `workflow_call` trigger should accept a single input and produce two outputs:  
     - i. The input should be named `target-directory`, be required, and be of type `string`.  
     - ii. The first output should be named `build-status`, have a description of *The status of the build process*, and have the value set to the `build-status` output of the `deploy` job.  
     - iii. The second output should be named `url`, have a description of *The url of the deployed version*, and have the value set to the `url` output of the `deploy` job.

4. Add a single job named `deploy` to the workflow.  
   - a. It should run on `ubuntu-latest`.  
   - b. It should define two outputs:  
     - i. `build-status`, taking its value from an analogous output of the `build` step.  
     - ii. `url`, taking its value from an analogous output of the `deploy` step.  
   - c. It should contain three steps:  
     - i. The first step, named *Checkout repo*, should checkout the code using the appropriate third-party action.  
     - ii. The second step, named *Build*, should have an id of `build`, print the message `"Building using directory <retrieve the value of the target-directory input here>"`, and set the output `build-status` with a value of `success`.  
     - iii. The third step, named *Deploy*, should have an id of `deploy`, print the message `"Deploying build artifacts"`, and set the output `url` with a value of `https://www.google.com`.

5. Now create a new workflow file named `18-2-reusable-workflow.yaml` under the `.github/workflows` folder at the root of your repository.

6. Name the workflow **18 – 2 – Reusable Workflows**.

7. Add the following triggers with event filters and activity types to your workflow:  
   - a. `workflow_dispatch`

8. Add a first job named `deploy` to the workflow.  
   - a. It should use the reusable workflow defined above. For that, simply use the `uses` key at the job level and pass the path of the workflow: `./.github/workflows/18-1-reusable-workflows.yaml`.  
   - b. Pass any value as a `target-directory` argument to the reusable workflow.

9. Add a second job named `print-outputs` to the workflow.  
   - a. It should run on `ubuntu-latest`.  
   - b. It should have a dependency on the `deploy` job.  
   - c. It should contain a single step named *Print outputs*, which prints the following two messages on the screen:  
     - i. `"Build status: <retrieve the build-status output from the deploy job>"`  
     - ii. `"URL: <retrieve the url output from the deploy job>"`

10. Commit the changes and push the code. Trigger the workflow manually from the UI and take a few moments to inspect the result of the workflow run.

---

### Polish Translation

W tym ćwiczeniu praktycznym naszym celem jest zapoznanie się z tworzeniem i używaniem workflow wielokrotnego użytku (reusable workflows).

Instrukcje do wykonania ćwiczenia:

1. Utwórz plik `18-1-reusable-workflows.yaml` w folderze `.github/workflows` w głównym katalogu repozytorium.

2. Nazwij workflow **18 – 1 – Reusable Workflows – Reusable Definition**.

3. Dodaj poniższe wyzwalacze z filtrami zdarzeń i typami aktywności do workflow:  
   - a. `workflow_call`: dodatkowo, wyzwalacz `workflow_call` powinien akceptować jedno wejście i generować dwa wyjścia:  
     - i. Wejście powinno być nazwane `target-directory`, być wymagane i mieć typ `string`.  
     - ii. Pierwsze wyjście powinno być nazwane `build-status`, mieć opis *Status procesu budowania* i mieć wartość ustawioną na wynik `build-status` z zadania `deploy`.  
     - iii. Drugie wyjście powinno być nazwane `url`, mieć opis *Adres URL wdrożonej wersji* i mieć wartość ustawioną na wynik `url` z zadania `deploy`.

4. Dodaj pojedyncze zadanie o nazwie `deploy` do workflow.  
   - a. Powinno działać na `ubuntu-latest`.  
   - b. Powinno definiować dwa wyjścia:  
     - i. `build-status`, pobierające swoją wartość z analogicznego wyjścia kroku `build`.  
     - ii. `url`, pobierające swoją wartość z analogicznego wyjścia kroku `deploy`.  
   - c. Powinno zawierać trzy kroki:  
     - i. Pierwszy krok o nazwie *Checkout repo* powinien pobierać kod przy użyciu odpowiedniej akcji zewnętrznej.  
     - ii. Drugi krok o nazwie *Build* powinien mieć identyfikator `build`, wypisać wiadomość `"Building using directory <wartość wejścia target-directory>"` i ustawić wyjście `build-status` na wartość `success`.  
     - iii. Trzeci krok o nazwie *Deploy* powinien mieć identyfikator `deploy`, wypisać `"Deploying build artifacts"` i ustawić wyjście `url` na wartość `https://www.google.com`.

5. Utwórz nowy plik workflow o nazwie `18-2-reusable-workflow.yaml` w folderze `.github/workflows`.

6. Nazwij workflow **18 – 2 – Reusable Workflows**.

7. Dodaj następujące wyzwalacze do workflow:  
   - a. `workflow_dispatch`

8. Dodaj pierwsze zadanie o nazwie `deploy` do workflow.  
   - a. Powinno korzystać z wcześniej zdefiniowanego reusable workflow. W tym celu użyj klucza `uses` na poziomie zadania i przekaż ścieżkę: `./.github/workflows/18-1-reusable-workflows.yaml`.  
   - b. Przekaż dowolną wartość jako argument `target-directory` do workflow.

9. Dodaj drugie zadanie o nazwie `print-outputs` do workflow.  
   - a. Powinno działać na `ubuntu-latest`.  
   - b. Powinno mieć zależność od zadania `deploy`.  
   - c. Powinno zawierać jeden krok o nazwie *Print outputs*, który wypisze dwie wiadomości:  
     - i. `"Build status: <wartość wyjścia build-status z zadania deploy>"`  
     - ii. `"URL: <wartość wyjścia url z zadania deploy>"`

10. Zatwierdź zmiany i wypchnij kod. Uruchom workflow ręcznie z poziomu interfejsu GitHub i sprawdź wynik działania.
