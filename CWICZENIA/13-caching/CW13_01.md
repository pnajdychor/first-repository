
# Practical Exercise 15 - Using Caching to Speed Up Installing Dependencies / Ćwiczenie praktyczne 15 – Wykorzystanie buforowania do przyspieszenia instalacji zależności

---

## **English Version**

### Exercise Description

In this practical exercise, our goal is to explore how we can use caching to temporarily store and retrieve the contents of folders between and within workflow runs.

In order to achieve that, we will leverage a React application that we will scaffold with the help of the `create-react-app` utility.  
Check the tips section for the specific command to scaffold your React application.  
Here are the instructions for the exercise:

1. **Generate a React application:**
   - a. Create a new folder named `13-caching` at the root of the repository.  
   - b. Using a terminal, navigate to this directory and scaffold a React application inside a `react-app` directory.  
      You can either create the directory yourself or let the `create-react-app` utility do it for you.  
   - c. Once the React setup is done, you should see a success message.  
   - d. Take a few moments to inspect the files and get familiar with the application folder structure.  

2. **Create the first version of the workflow:**
   - a. Create a file named `13-caching.yaml` under the `.github/workflows` folder at the root of your repository.  
   - b. Name the workflow `13 – Using Caching`.  
   - c. Add the following triggers to your workflow:  
     - i. `workflow_dispatch`: the `workflow_dispatch` trigger should accept an input named `use-cache`, of type `boolean`, default value `true`, and description `Whether to execute cache step`.  
   - d. Add a single job named `build` to the workflow:  
     - i. The job should run on `ubuntu-latest`.  
     - ii. The job should set `13-caching/react-app` as the default `working-directory` option for `run` commands.  
     - iii. The job should contain six steps:  
       -  i. The first one, named **Checkout code**, should checkout the repository code into the current working directory.  
       -  ii. The second one, named **Setup Node**, should setup Node with the version `20.x`.  
       -  iii. The third one, named **Install dependencies**, should execute the `npm ci` command.  
       -  iv. The fourth one, named **Testing**, should execute the `npm run test` command.  
       -  v. The fifth one, named **Building**, should execute the `npm run build` command.  
       -  vi. The sixth one, named **Deploying to nonprod**, should print the following message: `"Deploying to nonprod"`.  
   - e. Commit the changes and push the code. Trigger the workflow a few times and inspect the running times of each step.  
      How much time does it take to install the dependencies? How much time would it take if the workflow ran 1000 times?  

3. **Extend the workflow** with both an input for `node-version` and the possibility of using caching. To do that:  
   - a. Add a new input named `node-version`, of type `choice`, options `18.x`, `20.x`, and `21.x`, default value `20.x`, and description `Node version`.  
   - b. Update the **Setup Node** step to use the value provided as an input instead of the hard-coded value `20.x`.  
   - c. Add a new step after the **Setup Node** step:  
     - i. It should be named **Download cached dependencies**.  
     - ii. It should have an id of `cache`.  
     - iii. It should run only if the input `use-cache` is set to `true`.  
     - iv. It should use the `actions/cache@v3` third-party action.  
     - v. It should pass the following inputs to the action:  
       -  i. The key should be  
         ```yaml
         deps-node-modules-${{ hashFiles('13-caching/react-app/package-lock.json') }}
         ```  
       -  ii. The path where to restore the cache should be `13-caching/react-app/node_modules`.  
             It's important to provide the full path, since the `working-directory` option set at the job level applies only to run commands.  
   - d. Update the **Install dependencies** step to run **only if** no cache is found for the provided key.  
      This can be done by leveraging the outputs of the `cache` step. If there is a cache, the `cache-hit` output will be set to `'true'` (a string, not a boolean).  
   - e. Commit the changes and push the code. Trigger the workflow a few times and inspect the running times.  
      How much time does it take to install dependencies now? How big is the difference compared to running without caching?  

---

### Tips

**Scaffolding a React application with create-react-app**

To generate a React application with a single command, you can leverage the `create-react-app` utility.  
Run the following inside the `13-caching` folder:  
```bash
npx create-react-app --template typescript react-app
```

---

## **Wersja polska**

### Opis ćwiczenia

W tym ćwiczeniu praktycznym naszym celem jest zbadanie, jak możemy wykorzystać buforowanie (caching) do tymczasowego przechowywania i pobierania zawartości folderów pomiędzy uruchomieniami workflow.

Aby to osiągnąć, wykorzystamy aplikację React, którą utworzymy za pomocą narzędzia `create-react-app`.  
Sprawdź sekcję „Porady”, aby znaleźć dokładną komendę do wygenerowania aplikacji React.  
Oto instrukcje do ćwiczenia:

1. **Wygeneruj aplikację React:**  
   - a. Utwórz nowy folder o nazwie `13-caching` w katalogu głównym repozytorium.  
   - b. W terminalu przejdź do tego folderu i utwórz aplikację React w katalogu `react-app`.  
      Możesz utworzyć katalog samodzielnie lub pozwolić, by zrobiło to narzędzie `create-react-app`.  
   - c. Po zakończeniu konfiguracji Reacta powinien pojawić się komunikat o powodzeniu.  
   - d. Poświęć chwilę, aby zapoznać się ze strukturą plików aplikacji.  

2. **Utwórz pierwszą wersję workflow:**  
   - a. Utwórz plik o nazwie `13-caching.yaml` w folderze `.github/workflows` w katalogu głównym repozytorium.  
   - b. Nazwij workflow `13 – Using Caching`.  
   - c. Dodaj następujący wyzwalacz:  
      i. `workflow_dispatch`: wyzwalacz powinien przyjmować parametr `use-cache`, typu `boolean`, z domyślną wartością `true` oraz opisem `Whether to execute cache step`.  
   - d. Dodaj jedno zadanie o nazwie `build`:  
     - i. Zadanie powinno działać na `ubuntu-latest`.  
     - ii. Powinno ustawić `13-caching/react-app` jako domyślny katalog roboczy (`working-directory`) dla komend `run`.  
     - iii. Powinno zawierać sześć kroków:  
       -  i. **Checkout code** – pobiera kod repozytorium.  
       -  ii. **Setup Node** – ustawia wersję Node `20.x`.  
       -  iii. **Install dependencies** – wykonuje komendę `npm ci`.  
       -  iv. **Testing** – wykonuje komendę `npm run test`.  
       -  v. **Building** – wykonuje komendę `npm run build`.  
       -  vi. **Deploying to nonprod** – wyświetla komunikat `"Deploying to nonprod"`.  
   - e. Zatwierdź zmiany i wypchnij kod. Uruchom workflow kilka razy i porównaj czasy wykonywania kroków.  
      Jak długo trwa instalacja zależności? Jak długo trwałoby to po 1000 uruchomieniach?  

3. **Rozszerz workflow** o parametr `node-version` oraz możliwość użycia cache’a:  
   - a. Dodaj nowy parametr `node-version` typu `choice` z opcjami `18.x`, `20.x`, `21.x`, wartością domyślną `20.x` i opisem `Node version`.  
   - b. Zaktualizuj krok **Setup Node**, aby używał wartości parametru zamiast stałej `20.x`.  
   - c. Dodaj nowy krok po **Setup Node**:  
     - i. Nazwij go **Download cached dependencies**.  
     - ii. Nadaj mu identyfikator `cache`.  
     - iii. Powinien uruchamiać się tylko wtedy, gdy `use-cache` jest ustawione na `true`.  
     - iv. Powinien korzystać z zewnętrznej akcji `actions/cache@v3`.  
     - v. Przekaż do niej następujące dane wejściowe:  
       -  i. Klucz (`key`):  
         ```yaml
         deps-node-modules-${{ hashFiles('13-caching/react-app/package-lock.json') }}
         ```  
       -  ii. Ścieżka (`path`): `13-caching/react-app/node_modules`.  
             Należy podać pełną ścieżkę, ponieważ ustawienie `working-directory` na poziomie zadania dotyczy tylko poleceń `run`.  
   - d. Zaktualizuj krok **Install dependencies**, aby wykonywał się tylko wtedy, gdy nie znaleziono cache’a dla podanego klucza.  
      Można to osiągnąć, wykorzystując dane wyjściowe kroku `cache`. Jeśli cache istnieje, wartość `cache-hit` będzie ustawiona na `'true'` (jako tekst, nie boolean).  
   - e. Zatwierdź zmiany i wypchnij kod. Uruchom workflow kilka razy i porównaj czasy instalacji zależności z oraz bez cache’a.  

---

### Porady

**Tworzenie aplikacji React przy użyciu create-react-app**

Aby wygenerować aplikację React jednym poleceniem, użyj narzędzia `create-react-app`.  
W folderze `13-caching` wykonaj polecenie:  
```bash
npx create-react-app --template typescript react-app
```
