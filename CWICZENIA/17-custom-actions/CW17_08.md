# Practical Exercise 30 - Working with Outputs in Custom Actions

## Exercise Description (Opis ćwiczenia)

### English Version

In this practical exercise, our goal is to understand how to set outputs from all three different types of custom actions available in GitHub Actions.

Here are the instructions for the exercise:

1. Let's start with the composite custom action. Extend the composite custom action `action.yaml` file under `.github/actions/composite-cache-deps` by:  
   a. Adding an `outputs` top-level key, and under it a single output named `installed-deps`. It should have the description of *Whether dependencies were installed or not*, and a value of `${{ steps.cache.outputs.cache-hit != 'true' }}`. Composite actions allow us to directly reference outputs from individual steps, so setting up an output within the custom action is very straightforward.

2. Extend the workflow `17-1-custom-actions-composite.yaml` by:  
   a. Adding an id of `setup-deps` to the step named *Setup Node and NPM Dependencies*.  
   b. Adding an additional step after the `setup-deps` step:  
      i. The new step should be named *Print setup deps output*.  
      ii. It should print `"Installed dependencies: <value of the installed-deps output from the setup-deps step>"`.

3. Commit the changes and push the code. Trigger the `17-1-custom-actions-composite.yaml` workflow from the UI and take a few moments to inspect the output of the workflow run.

4. Let's now move on to the JavaScript custom action. Extend the JavaScript custom action `action.yaml` file under `.github/actions/js-dependency-update` by:  
   a. Adding an `outputs` top-level key, and under it a single output named `updates-available`. It should have the description of *Whether there are updates available*. JavaScript custom actions require us to set the values of the outputs from within the JavaScript code, so let's do that next.

5. From within the `index.js` file, use the `setOutput` method from the `@actions/core` package to set the `updates-available` output to either `true` or `false` depending on whether there were updates available.

6. Extend the workflow `17-2-custom-actions-js.yaml` by:  
   a. Adding an id of `update-deps` to the step named *Check for dependency updates*.  
   b. Adding an additional step after the `update-deps` step:  
      i. The new step should be named *Print custom action output*.  
      ii. It should print `"Updates available: <value of the updates-available output from the setup-deps step>"`.

7. Commit the changes and push the code. Trigger the `17-2-custom-actions-js.yaml` workflow from the UI and take a few moments to inspect the output of the workflow run.

8. Last but not least, let's move on to the Docker custom action. Extend the Docker custom action `action.yaml` file under `.github/actions/docker-ping-url` by:  
   a. Adding an `outputs` top-level key, and under it a single output named `url-reachable`. It should have the description of *Whether the URL is reachable*. Docker custom actions require us to set the values of the outputs from within the code, so let's do that next.

9. For Docker custom actions which are not written in JavaScript or TypeScript, we cannot leverage the `@actions/core` package to set outputs. Therefore, we must append the values to the output file, as we have done in *Section 12: Inputs & Outputs*:  
   a. From within the `main.py` file, open the file which path is stored under the `GITHUB_OUTPUT` environment variable. Use the append mode by providing `'a'` as the second argument to the `open()` function.  
   b. Use the print statement to write a line in the format `<key>=<value>` to the opened file, e.g.:  
      ```python
      print(f'url-reachable=<interpolate return value of ping_url here>', file=file)
      ```

10. Extend the workflow `17-3-custom-actions-docker.yaml` by:  
    a. Adding an id of `ping-url` to the step named *Ping URL*.  
    b. Adding an additional step after the `ping-url` step:  
       i. The new step should be named *Print output from ping url*.  
       ii. It should print `"URL reachable: <value of the url-reachable output from the ping-url step>"`.

11. Commit the changes and push the code. Trigger the `17-3-custom-actions-docker.yaml` workflow from the UI and take a few moments to inspect the output of the workflow run.

---

### Polish Translation

W tym ćwiczeniu praktycznym naszym celem jest zrozumienie, jak ustawiać wyjścia (outputs) dla wszystkich trzech typów niestandardowych akcji dostępnych w GitHub Actions.

Instrukcje do wykonania ćwiczenia:

1. Zacznijmy od złożonej akcji niestandardowej (composite). Rozszerz plik `action.yaml` w katalogu `.github/actions/composite-cache-deps` poprzez:  
   a. Dodanie głównego klucza `outputs`, a pod nim pojedynczego wyjścia o nazwie `installed-deps`. Powinno ono mieć opis *Czy zależności zostały zainstalowane, czy nie* oraz wartość `${{ steps.cache.outputs.cache-hit != 'true' }}`. Akcje typu composite pozwalają bezpośrednio odwoływać się do wyników z poszczególnych kroków, więc skonfigurowanie wyjścia jest bardzo proste.

2. Rozszerz workflow `17-1-custom-actions-composite.yaml` poprzez:  
   a. Dodanie identyfikatora `setup-deps` do kroku o nazwie *Setup Node and NPM Dependencies*.  
   b. Dodanie dodatkowego kroku po `setup-deps`:  
      i. Nowy krok powinien mieć nazwę *Print setup deps output*.  
      ii. Powinien wypisywać `"Installed dependencies: <wartość wyjścia installed-deps z kroku setup-deps>"`.

3. Zatwierdź zmiany i wypchnij kod. Uruchom workflow `17-1-custom-actions-composite.yaml` z poziomu interfejsu GitHub i sprawdź wynik działania.

4. Przejdź teraz do akcji niestandardowej w JavaScript. Rozszerz plik `action.yaml` w katalogu `.github/actions/js-dependency-update` poprzez:  
   a. Dodanie klucza `outputs` i jednego wyjścia `updates-available` z opisem *Czy dostępne są aktualizacje*. Akcje JavaScript wymagają ustawienia wartości wyjść w samym kodzie, więc zrobimy to w kolejnym kroku.

5. W pliku `index.js` użyj metody `setOutput` z pakietu `@actions/core`, aby ustawić `updates-available` na `true` lub `false` w zależności od tego, czy aktualizacje były dostępne.

6. Rozszerz workflow `17-2-custom-actions-js.yaml` poprzez:  
   a. Dodanie identyfikatora `update-deps` do kroku *Check for dependency updates*.  
   b. Dodanie dodatkowego kroku po `update-deps`:  
      i. Nowy krok powinien mieć nazwę *Print custom action output*.  
      ii. Powinien wypisywać `"Updates available: <wartość wyjścia updates-available z kroku setup-deps>"`.

7. Zatwierdź zmiany i wypchnij kod. Uruchom workflow `17-2-custom-actions-js.yaml` z poziomu UI i przeanalizuj wyniki działania.

8. Na koniec przejdź do akcji Dockera. Rozszerz plik `action.yaml` w katalogu `.github/actions/docker-ping-url` poprzez:  
   a. Dodanie klucza `outputs` oraz pojedynczego wyjścia `url-reachable` z opisem *Czy adres URL jest osiągalny*. Wartości wyjść muszą być ustawione w kodzie, więc zrobimy to w następnym kroku.

9. W przypadku akcji Dockera, które nie są napisane w JavaScript lub TypeScript, nie możemy użyć pakietu `@actions/core` do ustawienia wyjść. Musimy dodać wartości do pliku wyjściowego, jak pokazano w *Sekcji 12: Inputs & Outputs*:  
   a. W pliku `main.py` otwórz plik, którego ścieżka jest przechowywana w zmiennej środowiskowej `GITHUB_OUTPUT`, używając trybu dopisywania (`'a'`).  
   b. Użyj polecenia `print`, aby zapisać w pliku linię w formacie `<klucz>=<wartość>`, np.:  
      ```python
      print(f'url-reachable=<wartość zwrócona przez ping_url>', file=file)
      ```

10. Rozszerz workflow `17-3-custom-actions-docker.yaml` poprzez:  
    a. Dodanie identyfikatora `ping-url` do kroku *Ping URL*.  
    b. Dodanie dodatkowego kroku po `ping-url`:  
       i. Nowy krok powinien mieć nazwę *Print output from ping url*.  
       ii. Powinien wypisywać `"URL reachable: <wartość wyjścia url-reachable z kroku ping-url>"`.

11. Zatwierdź zmiany i wypchnij kod. Uruchom workflow `17-3-custom-actions-docker.yaml` z poziomu UI i sprawdź wyniki działania.
