# Practical Exercise 27 - Setting Up Our Docker Custom Action

## Exercise Description (Opis ćwiczenia)

### English Version

In this practical exercise, our goal is to explore how to set up a Docker custom action in GitHub Actions.

The goal of our Docker custom action is to ping a website to check for its availability and to abstract that behind an easy-to-use reusable action. This and the following exercises require Python installed locally, just make sure you have any version later than 3.9.x.

### Polish Translation

W tym ćwiczeniu praktycznym naszym celem jest poznanie sposobu konfiguracji niestandardowej akcji Dockera w GitHub Actions.

Celem naszej niestandardowej akcji Dockera jest pingowanie strony internetowej w celu sprawdzenia jej dostępności oraz ukrycie tego za prostą w użyciu akcją wielokrotnego użytku. To i kolejne ćwiczenia wymagają lokalnie zainstalowanego Pythona, upewnij się tylko, że masz wersję nowszą niż 3.9.x.

---

## Instructions (Instrukcje)

### English Version

1. Create the folder `.github/actions/docker-ping-url`.  
   This folder is where we will host all the files for our Docker custom action.

2. Add the `action.yaml` file:  
   a. Create a file named `action.yaml` under the folder `.github/actions/docker-ping-url`.  
   b. In the `action.yaml` file, add the following properties:  
      i. A `name` of `Ping URL`;  
      ii. A `description` of `"Ping URL until maximum trials have exceeded. If result is not 200 until then, fails the action."`;  
      iii. The action should receive three inputs:  
         - `url`: required, description `URL to ping`  
         - `max_trials`: optional, description `Maximum number of trials until action fails`, default `'10'`  
         - `delay`: optional, description `Delay in seconds between trials`, default `'5'`  
      iv. Add a top-level `runs` key:  
         ```yaml
         runs:
           using: docker
           image: Dockerfile
         ```

3. Set up the local environment and dependencies for the Python script:  
   a. Open a terminal and change into this directory.  
   b. Create a Python virtual environment:  
      ```bash
      python -m venv venv
      ```  
      Add `venv` to `.gitignore`.  
   c. Activate the virtual environment:  
      ```bash
      . venv/bin/activate
      ```  
   d. Install dependencies:  
      ```bash
      pip install "requests==2.31.0"
      ```  
   e. Save them:  
      ```bash
      pip freeze > requirements.txt
      ```

4. Create a `main.py` file under `.github/actions/docker-ping-url` and add:  
   ```python
   if __name__ == "__main__":
       print("Hello world")
   ```

5. Add a `Dockerfile` under `.github/actions/docker-ping-url` using `python:alpine3.19` as base image.  
   Also, add a `.dockerignore` file containing only `venv`.

6. Create a workflow file named `17-3-custom-actions-docker.yaml` under `.github/workflows`.

7. Name the workflow **17 – 3 – Custom Actions – Docker**.

8. Add triggers with `workflow_dispatch`, which should receive an input `url` (type string, default `'https://www.google.com'`).

9. Add a job named `ping-url`:  
   a. It should run on `ubuntu-latest`.  
   b. Steps:  
      i. Checkout the code.  
      ii. Run the Docker custom action:  
      ```yaml
      uses: ./github/actions/docker-ping-url
      with:
        url: ${{ github.event.inputs.url }}
      ```

10. Commit and push the code, then trigger the workflow in GitHub UI.

---

### Polish Translation

1. Utwórz folder `.github/actions/docker-ping-url`.  
   W tym folderze umieścimy wszystkie pliki dla naszej niestandardowej akcji Dockera.

2. Dodaj plik `action.yaml`:  
   a. Utwórz plik o nazwie `action.yaml` w folderze `.github/actions/docker-ping-url`.  
   b. W pliku `action.yaml` dodaj następujące właściwości:  
      i. Nazwa (`name`) – `Ping URL`;  
      ii. Opis (`description`) – `"Ping URL do momentu przekroczenia maksymalnej liczby prób. Jeśli wynik nie wyniesie 200, akcja się nie powiedzie."`;  
      iii. Akcja powinna przyjmować trzy wejścia:  
         - `url`: wymagane, opis `Adres URL do pingowania`  
         - `max_trials`: opcjonalne, opis `Maksymalna liczba prób zanim akcja się nie powiedzie`, domyślnie `'10'`  
         - `delay`: opcjonalne, opis `Opóźnienie w sekundach między próbami`, domyślnie `'5'`  
      iv. Dodaj klucz główny `runs`:  
         ```yaml
         runs:
           using: docker
           image: Dockerfile
         ```

3. Skonfiguruj lokalne środowisko i zależności dla skryptu Python:  
   a. Otwórz terminal i przejdź do tego katalogu.  
   b. Utwórz środowisko wirtualne Pythona:  
      ```bash
      python -m venv venv
      ```  
      Dodaj `venv` do `.gitignore`.  
   c. Aktywuj środowisko:  
      ```bash
      . venv/bin/activate
      ```  
   d. Zainstaluj zależności:  
      ```bash
      pip install "requests==2.31.0"
      ```  
   e. Zapisz zależności:  
      ```bash
      pip freeze > requirements.txt
      ```

4. Utwórz plik `main.py` w folderze `.github/actions/docker-ping-url` i dodaj:  
   ```python
   if __name__ == "__main__":
       print("Hello world")
   ```

5. Dodaj plik `Dockerfile` w folderze `.github/actions/docker-ping-url` używając `python:alpine3.19` jako obrazu bazowego.  
   Dodaj plik `.dockerignore` z wpisem `venv`.

6. Utwórz plik workflow `17-3-custom-actions-docker.yaml` w folderze `.github/workflows`.

7. Nazwij workflow **17 – 3 – Custom Actions – Docker**.

8. Dodaj wyzwalacz `workflow_dispatch` z wejściem `url` (typ string, domyślnie `'https://www.google.com'`).

9. Dodaj zadanie `ping-url`:  
   a. Uruchom na `ubuntu-latest`.  
   b. Kroki:  
      i. Sprawdź kod (`checkout`).  
      ii. Uruchom niestandardową akcję Dockera:  
      ```yaml
      uses: ./github/actions/docker-ping-url
      with:
        url: ${{ github.event.inputs.url }}
      ```

10. Zatwierdź i wypchnij kod, a następnie uruchom workflow w interfejsie GitHub.

