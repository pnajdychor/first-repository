# Practical Exercise 35 - Preventing Script Injection via Intermediate Variables

## Exercise Description (Opis ćwiczenia)

### English Version

In this practical exercise, our goal is to get familiar with preventing script injection attacks in GitHub Actions.

Here are the instructions for the exercise:

1. Create a file named `20-workflow-security.yaml` under the `.github/workflows` folder at the root of your repository.

2. Name the workflow **20 – Workflow Security**.

3. Add the following triggers to your workflow:  
   a. `pull_request`

4. Add a single job named `unsafe-pr` to the workflow.  
   a. It should run on `ubuntu-latest`.  
   b. It should contain two steps:  
      i. The first step should checkout the code using the appropriate third-party action.  
      ii. The second step, named *Check PR title*, should run the following shell script (it checks whether the PR title starts with the substring `feat` and prints a message accordingly):  

```bash
title=${{ github.event.pull_request.title }}
if [[ $title =~ ^feat ]]; then
  echo "PR is a feature"
  exit 0
else
  echo "PR is not a feature"
  exit 1
fi
```

5. Commit the changes and push the code. Create a PR by changing any file in the repository, committing the changes to a new branch, and proposing the changes via a PR. Provide the following title to the PR: `"abc"; ls -R;`. Take a few moments to inspect the result of the triggered workflow run. Which commands did it execute?

6. Add a second job named `safer-pr` to the workflow.  
   a. It should run on `ubuntu-latest`.  
   b. It should contain two steps:  
      i. The first step should checkout the code using the appropriate third-party action.  
      ii. The second step, named *Check PR title*, should execute the same script as above. However, instead of setting the `title` variable in the shell command, it should set an `env` variable named `TITLE` and with value set to the PR title, and then reference this variable from within the shell script.

7. Commit the changes and push the code. Create a PR yet another time by changing any file in the repository, committing the changes to a new branch, and proposing the changes via a PR. Provide the following title to the PR: `"abc"; ls -R;`. Take a few moments to inspect the result of the triggered workflow run. Were the malicious commands executed?

---

### Polish Translation

W tym ćwiczeniu praktycznym naszym celem jest zapoznanie się z zapobieganiem atakom typu *script injection* w GitHub Actions.

Instrukcje do wykonania ćwiczenia:

1. Utwórz plik o nazwie `20-workflow-security.yaml` w folderze `.github/workflows` w głównym katalogu repozytorium.

2. Nazwij workflow **20 – Workflow Security**.

3. Dodaj następujący wyzwalacz do workflow:  
   a. `pull_request`

4. Dodaj pojedyncze zadanie o nazwie `unsafe-pr` do workflow.  
   a. Powinno działać na `ubuntu-latest`.  
   b. Powinno zawierać dwa kroki:  
      i. Pierwszy krok powinien pobrać kod przy użyciu odpowiedniej akcji zewnętrznej.  
      ii. Drugi krok, nazwany *Check PR title*, powinien uruchomić poniższy skrypt powłoki (sprawdza on, czy tytuł PR zaczyna się od ciągu `feat` i drukuje odpowiedni komunikat):  

```bash
title=${{ github.event.pull_request.title }}
if [[ $title =~ ^feat ]]; then
  echo "PR is a feature"
  exit 0
else
  echo "PR is not a feature"
  exit 1
fi
```

5. Zatwierdź zmiany i wypchnij kod. Utwórz PR, zmieniając dowolny plik w repozytorium, zatwierdź zmiany w nowej gałęzi i zaproponuj je jako PR. Nadaj PR tytuł: `"abc"; ls -R;`. Następnie przeanalizuj wynik działania workflow. Jakie polecenia zostały wykonane?

6. Dodaj drugie zadanie o nazwie `safer-pr` do workflow.  
   a. Powinno działać na `ubuntu-latest`.  
   b. Powinno zawierać dwa kroki:  
      i. Pierwszy krok powinien pobrać kod przy użyciu odpowiedniej akcji zewnętrznej.  
      ii. Drugi krok, nazwany *Check PR title*, powinien uruchamiać ten sam skrypt, jednak zamiast ustawiać zmienną `title` bezpośrednio w poleceniu powłoki, należy ustawić zmienną środowiskową `TITLE` (env), przypisać jej wartość tytułu PR i odwoływać się do niej w skrypcie powłoki.

7. Zatwierdź zmiany i wypchnij kod. Utwórz ponownie PR, zmieniając dowolny plik w repozytorium, zatwierdź zmiany w nowej gałęzi i zaproponuj je jako PR. Użyj tytułu: `"abc"; ls -R;`. Następnie przeanalizuj wynik działania workflow. Czy złośliwe polecenia zostały wykonane?
